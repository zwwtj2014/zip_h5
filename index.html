<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Êñá‰ª∂ÂéãÁº©Â∑•ÂÖ∑</title>
    <meta name="description" content="Âú®Á∫øÊñá‰ª∂ÂéãÁº©Â∑•ÂÖ∑ÔºåÊîØÊåÅÂ§öÁßçÊñá‰ª∂Ê†ºÂºèÂéãÁº©">
    
    <!-- ÂºïÂÖ•Â§ñÈÉ®Â∑•ÂÖ∑Â∫ì -->
    <script src="https://zww2.xiexinbao.com/js/zww_utils.js"></script>
    <script src="https://zww2.xiexinbao.com/js/custom-toast.js"></script>
    <script src="js/zww_uploader.js"></script>
    
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        *::-webkit-scrollbar{display:none;width:0px;height:0px;}
        *::-webkit-scrollbar-corner {display:none;width:0px;height:0px; }
        *::-webkit-resizer{display:none;}
        
        body {
            font-size: 12px;
            background: #edeef0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            touch-action: manipulation;
        }
        
        /* Â§¥ÈÉ®Ê†∑Âºè */
        #header {
            height: 72px;
            text-align: center;
            --tw-shadow-color: 0 0 #000;
            --tw-shadow: 0px 0px 4px rgba(14, 19, 24, .07) !important;
            --tw-shadow-colored: 0px 0px 4px var(--tw-shadow-color) !important;
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)!important;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            width: 100%;
            background: white;
            z-index: 1000;
        }
        
        #header .logo-name {
            color: #54616c;
            font-size: 24px;
            letter-spacing: 2px;
            font-weight: bold;
            font-family: douyin;
        }
        
        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü */
        .common-list-box {
            display: flex;
            justify-content: center;
            flex-direction: column;
            padding-top: 72px;
        }
        
        .common-list {
            background: #edeef0;
            width: min(100%, 620px);
            padding: 5px 20px 20px;
            margin: 10vh auto 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .common-item {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            text-align: center;
            border-radius: min(3vw, 24px);
            padding: min(30px);
            background-color: white;
            flex: 0 0 20vw;
            transition: all 0.3s ease;
            box-shadow: 0 2px 3px 3px rgb(0 0 0 / 3%);
            background: linear-gradient(180deg, #fff, #fffbe6);
            align-items: center;
        }
        
        .common-item .common-name {
            padding: 16px 0;
            font-size: 18px;
        }
        
        .btnUpload {
            margin-top: 8px;
            padding: 8px 24px;
            background-color: #3B82F6;
            color: white;
            font-size: 14px;
            border-radius: 8px;
            transition: background-color 0.2s;
            border: none;
            cursor: pointer;
            display: flex;
            margin-right: 2px;
            align-items: center;
            gap: 8px;
            min-height: 44px;
        }
        
        .btnUpload:hover {
            background-color: #2563EB;
        }
        
        .btnUpload:active {
            transform: scale(0.98);
        }
        

        
        /* ÂéÜÂè≤ËÆ∞ÂΩïÂå∫Âüü */
        .order-list {
            background: #edeef0;
            width: min(100%, 620px);
            padding: 5px 20px 20px;
            margin: 0 auto;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .order-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #fff;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .item-icon {
            width: 40px;
            height: 40px;
            margin-right: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .file-info {
            flex: 1;
            overflow: hidden;
        }
        
        .file-name {
            font-size: 14px;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .download-btn {
            padding: 6px 12px;
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
            min-height: 32px;
            line-height: 20px;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .common-list {
                margin: 5vh auto 0;
                padding: 5px 15px 20px;
            }
            

        }
        
        @media (max-width: 480px) {
            #header .logo-name {
                font-size: 20px;
            }
            
            .common-item {
                padding: 20px;
            }
            
            .common-name {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Âõ∫ÂÆöÂ§¥ÈÉ® -->
    <div id="header">
        <span class="logo-name">Êñá‰ª∂ÂéãÁº©Â∑•ÂÖ∑</span>
    </div>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="common-list-box">
        <div class="common-list" id="common_list">
            <div class="common-item" onclick="btnUploadFile()">
                <div class="common-name">ÈÄâÊã©Êñá‰ª∂ËøõË°åÂéãÁº©</div>
                <button class="btnUpload">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width:16px;">
                        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M17 8L12 3M12 3L7 8M12 3V15" 
                              stroke="currentColor" 
                              strokeWidth="2" 
                              strokeLinecap="round" 
                              strokeLinejoin="round"/>
                    </svg>
                    ÈÄâÊã©Êñá‰ª∂
                </button>
            </div>
            

            
            <p style="text-align:center;padding:20px 10px 10px 10px;font-size:14px;">
                ÈÅáÂà∞ÈóÆÈ¢òÔºö<a id="kefu_url" onclick="callWxkefu()" style="text-decoration:none;color:rgb(0, 0, 238);cursor:pointer;">ÁÇπÊ≠§ËÅîÁ≥ªÂÆ¢Êúç</a>
            </p>
        </div>
    </div>
    
    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂå∫Âüü -->
    <div class="order-list"></div>

    <!-- ÂºïÂÖ•ÊåáÁ∫πËØÜÂà´Â∫ì -->
    <script src="https://caipiao88.oss-cn-hangzhou.aliyuncs.com/cdn/fp/thumbmark.umd.js"></script>
    <script>
        ThumbmarkJS.getFingerprint().then(
            function(fp) {
                window.fp_id = fp;
            }
        );
    </script>

    <!-- ‰∏ªË¶ÅËÑöÊú¨ -->
    <script src="js/analytics.js"></script>
    <script>
        // ÂÖ®Â±ÄÂèòÈáèÂàùÂßãÂåñ
        var admin_uid = getParamsFromUrl('admin_uid') || localStorage.getItem('admin_uid') || '';
        localStorage.setItem('admin_uid', admin_uid);
        
        var popDiv = null;
        var ua = navigator?.userAgent?.toLowerCase();
        
        // Êñá‰ª∂ÈÄâÊã©Áõ∏ÂÖ≥ÂèòÈáè
        var selectedFiles = [];
        
        // ‰ΩøÁî®$uploaderËøõË°åÊñá‰ª∂ÈÄâÊã©
        async function btnUploadFile() {
            try {
                // Ê£ÄÊü•$uploaderÊòØÂê¶Â∑≤Âä†ËΩΩ
                if (typeof $uploader === 'undefined') {
                    showToast('Êñá‰ª∂ÈÄâÊã©Âô®Êú™Âä†ËΩΩÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                    return;
                }
                
                // ‰ΩøÁî®$uploaderÈÄâÊã©Â§öÊñá‰ª∂
                var files = await $uploader.fileChooseMultiple({
                    accept: "*/*"
                });
                
                console.log('Êñá‰ª∂ÈÄâÊã©ÁªìÊûú:', files);
                
                if (files && files.length > 0) {
                    selectedFiles = Array.from(files);
                    console.log('Â∑≤ÈÄâÊã©Êñá‰ª∂Êï∞Èáè:', selectedFiles.length);
                    
                    // Êñá‰ª∂ÈÄâÊã©ÊâìÁÇπ
                    if (window.analytics) {
                        const totalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);
                        const fileTypes = getFileTypes(selectedFiles);
                        window.analytics.fileSelect(files.length, totalSize, fileTypes);
                    }
                    
                    showToast(`‚úÖ Â∑≤ÈÄâÊã© ${files.length} ‰∏™Êñá‰ª∂`);
                    
                    // Áõ¥Êé•Ë∑≥ËΩ¨Âà∞Êñá‰ª∂ÁÆ°ÁêÜÈ°µÈù¢
                    goToFileManager();
                } else {
                    console.log('Êñá‰ª∂ÈÄâÊã©‰∏∫Á©∫ÊàñÊú™ÂÆö‰πâ');
                    showToast('Êú™ÈÄâÊã©‰ªª‰ΩïÊñá‰ª∂');
                }
            } catch (error) {
                console.error('Êñá‰ª∂ÈÄâÊã©Â§±Ë¥•:', error);
                showToast('Êñá‰ª∂ÈÄâÊã©Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        
        // ‰∏ã‰∏ÄÊ≠•ÊåâÈíÆ
        function goToFileManager() {
            if (selectedFiles.length === 0) {
                showToast('‚ö†Ô∏è ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂');
                return;
            }
            
            // Êñá‰ª∂Êï∞ÊçÆ‰º†ÈÄí
            try {
                const fileData = selectedFiles.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type || '',
                    lastModified: file.lastModified
                }));
                
                // ‰ΩøÁî® localStorage Â≠òÂÇ®Êñá‰ª∂Êï∞ÊçÆÔºàÊõ¥ÊåÅ‰πÖÔºâ
                localStorage.setItem('selectedFilesData', JSON.stringify(fileData));
                localStorage.setItem('filesTransferTime', Date.now().toString());
                
                // È°µÈù¢Ë∑≥ËΩ¨ÊâìÁÇπ
                if (window.analytics) {
                    window.analytics.track('page_navigate', {
                        from: 'index',
                        to: 'file_manager',
                        file_count: selectedFiles.length,
                        total_size: getTotalSize()
                    });
                }
                
                // ‰ΩøÁî® POST ÊñπÂºèË∑≥ËΩ¨Ôºå‰øùÊåÅÊñá‰ª∂Âú®ÂÜÖÂ≠ò‰∏≠
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = 'file-manager.html';
                form.style.display = 'none';
                
                // ÂàõÂª∫ÈöêËóèÂ≠óÊÆµÂ≠òÂÇ®Êñá‰ª∂Êï∞Èáè
                const fileCountInput = document.createElement('input');
                fileCountInput.type = 'hidden';
                fileCountInput.name = 'fileCount';
                fileCountInput.value = selectedFiles.length;
                form.appendChild(fileCountInput);
                
                document.body.appendChild(form);
                
                // Âú®Êñ∞Á™óÂè£‰∏≠‰º†ÈÄíÊñá‰ª∂Êï∞ÊçÆ
                window.tempSelectedFiles = selectedFiles;
                
                window.location.href = 'file-manager.html';
            } catch (error) {
                if (window.analytics) {
                    window.analytics.error('file_transfer_error', error.message);
                }
                showToast('‚ùå Êñá‰ª∂‰º†ÈÄíÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        
        // Â∑•ÂÖ∑ÂáΩÊï∞
        function getFileTypes(files) {
            const types = {};
            files.forEach(file => {
                const ext = getFileExtension(file.name);
                types[ext] = (types[ext] || 0) + 1;
            });
            return types;
        }
        
        function getFileExtension(fileName) {
            return fileName.split('.').pop().toLowerCase() || 'unknown';
        }
        
        function getTotalSize() {
            return selectedFiles.reduce((sum, file) => sum + file.size, 0);
        }
        

        
        function showToast(message) {
            if (window.popToast && typeof window.popToast === 'function') {
                window.popToast({title: message, timeout: 3000});
            } else {
                console.log('Toast:', message);
            }
        }
        
        // ÂÆ¢ÊúçÂäüËÉΩ
        async function callWxkefu() {
            var user_id = getUserId() || window.fp_id || '';
            var wx_service_link = `https://work.weixin.qq.com/kfid/kfc7d846fca34c6ca69?enc_scene=ENCettynNzrtEHbKDpamvHQPpMev884BwvoYrk3i2CQymZ&scene_param=${user_id}`;
            
            const isWx = /micromessenger/i.test(navigator.userAgent);
            if (isWx) {
                window.location.href = wx_service_link;
                return;
            }
            
            // ÈùûÂæÆ‰ø°ÁéØÂ¢ÉÂ§ÑÁêÜ
            const hasTouchScreen = ('ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0);
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isMobile = isAndroid || isIOS || /webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            let deviceType = 'pc';
            if (hasTouchScreen && isMobile) {
                if (isAndroid) {
                    deviceType = 'android';
                } else if (isIOS) {
                    deviceType = 'iphone';
                } else {
                    deviceType = 'android';
                }
            }

            if (deviceType === 'pc') {
                // PCÁ´ØÂæÆ‰ø°Ë∑≥ËΩ¨ÈìæÊé•Â§ÑÁêÜ
                const parsedUrl = new URL(wx_service_link);
                const kfid = parsedUrl.pathname.split('/')[2];
                const encScene = parsedUrl.searchParams.get('enc_scene');
                const sceneParam = parsedUrl.searchParams.get('scene_param');
                const newUrl = new URL('weixin://jumptokfchat/');
                newUrl.searchParams.append('kfid', kfid);
                newUrl.searchParams.append('scene', '50');
                const extParams = new URLSearchParams();
                if (encScene) {
                    extParams.append('enc_scene', encScene);
                }
                if (sceneParam) {
                    extParams.append('scene_param', sceneParam);
                }
                extParams.append('refkey', '');
                newUrl.searchParams.append('ext_params', extParams.toString());
                wx_service_link = newUrl.toString();
            } else {
                // ÁßªÂä®Á´ØÂ§ÑÁêÜ
                try {
                    const getProtocol = () => window.location.protocol.indexOf('https') > -1 ? 'https:' : 'http:';
                    const response = await fetch(getProtocol() + '//www.xiexinbao.com/txb/wxticket', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                        body: `kfurl=${encodeURIComponent(wx_service_link)}`
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const _kefu_url = await response.text();
                    if (_kefu_url.startsWith('weixin://')) {
                        wx_service_link = _kefu_url;
                    }
                } catch (error) {
                    console.error("Ëé∑ÂèñÂæÆ‰ø°ÂÆ¢ÊúçÈìæÊé•Â§±Ë¥•:", error);
                }
            }
            
            window.location.href = wx_service_link;
        }
        
        // È°µÈù¢ËÆøÈóÆÊâìÁÇπ
        if (window.analytics) {
            window.analytics.pageView('index', {
                entry_time: new Date().toISOString()
            });
        }
        
        console.log('üöÄ ÂéãÁº©Â∑•ÂÖ∑Â∑≤Âä†ËΩΩÂÆåÊàê');
    </script>

    <!-- ÁªüËÆ°ËÑöÊú¨ -->
    <script>
        (function() {
            var cswtj_id = '';
            var _plat = window.location.hostname;
            var _w = 'compress.html';
            if (typeof localStorage == "object") {
                cswtj_id = localStorage.getItem('cswtj_id') || ''; 
            }
            function _loadtj(retries) {
                var hm = document.createElement("script");
                hm.src = getProtocol()+"//log.xiexinbao.com/cswtj.js?plat="+_plat+"&w="+_w+"&cswtj_id="+cswtj_id;
                hm.onload = function() {};
                hm.onerror = function() {
                    if (retries > 0) {
                        _loadtj(retries - 1);
                    }
                    console.log('cswtj.js load error!')
                };
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            }
            _loadtj(1);
        })();
    </script>
</body>
</html>